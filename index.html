<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Marionette Fundamentals</title>

	<!-- fonts -->
	<link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
	
	<!-- reset -->
	<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css">

  <!-- milligram -->
  <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/milligram/1.2.0/milligram.css">
</head>
<body>
	<style>
		.breadcrumbs li {
			list-style: none;
		}

		.breadcrumbs li::after {
			content: '/';
			display: inline-block;			
			margin: 0 5px;
		}
	</style>
	<div class="container">
		<div class="row">
			<div class="column">
				<div id="nav-breadcrumbs" class="clearfix"></div>
			</div>
		</div>
		<!-- /.row -->

		<div class="row">
			<div class="column">
				<div id="app" ></div>	
			</div>
		</div>
		<!-- /.row -->
	</div>

	<script id="index-template" type="text/x-backbone">
		<h2>Welcome to Marionette's User Admin App</h2>
		<p>A demo application written to Marionette.JS</p>

		<ul>
			<li><a href="#" id="nav-users-index">Users</a></li>
			<li><a href="#" id="roles">Roles</a></li>
		</ul>
	</script>

	<script id="user-details-layout-template" type="text/x-backbone">
		<div id="user-details-layout">
			<h1>User details</h1>

			<div class="row">
				<div class="column">
					<h2>Viewing <%= email %></h2>
				</div>
			</div>	

			<div class="row">
				<div class="column column-25" id="summary"></div>
				<div class="column column-75" id="profile"></div>
			</div>
		</div>
	</script>

	<script id="user-summary-template" type="text/x-backbone">
		<ul>
			<li>Item 1</li>
			<li>Item 2</li>
		</ul>
	</script>

	<script id="user-profile-template" type="text/x-backbone">
		<h3>User profile</h3>
	</script>

	<script src="//cdn.jsdelivr.net/jquery/3.1.1/jquery.min.js"></script>
	<script src="//cdn.jsdelivr.net/underscorejs/1.8.3/underscore-min.js"></script>
	<script src="//cdn.jsdelivr.net/backbonejs/1.3.3/backbone-min.js"></script>
	<script src="//cdn.jsdelivr.net/backbone.marionette/2.4.5/backbone.marionette.min.js"></script>
	<script defer src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<!-- BreadCrumbs -->
	<script src="user-admin/breadcrumb/model.js"></script>
	<script src="user-admin/breadcrumb/views.js"></script>
	<script src="user-admin/breadcrumb/index.js"></script>

	<!-- Users -->
	<script src="user-admin/user/router.js"></script>
	<script src="user-admin/user/model.js"></script>
	<script src="user-admin/user/controller.js"></script>
	<script src="user-admin/user/views.js"></script>
	<script src="user-admin/user/index.js"></script>

	<!-- Home -->
	<script src="user-admin/home/router.js"></script>
	<script src="user-admin/home/controller.js"></script>
	<script src="user-admin/home/views.js"></script>

	<script>
		$(function() {
			var testData = [
				{id: 1, email: "test1@email.com"},
				{id: 2, email: "test2@email.com"},
				{id: 3, email: "test3@email.com"},
				{id: 4, email: "test4@email.com"}
			];

			var UserAdmin = new Marionette.Application();

			UserAdmin.addRegions({
				mainRegion: "#app",
				navRegion: '#nav-breadcrumbs'
			});

			// Events
			UserAdmin.addInitializer(function() {
				var crumbs = {
					home: {
						title: 'Home', trigger: 'index:selected'
					},
					list: {
						title: 'User listing', trigger: 'userList:selected'
					}
				};
				
				var breadCrumbs = new BreadCrumbModule(UserAdmin);
				breadCrumbs.load(UserAdmin.navRegion, {title: 'Home'});

				var user = new UserModule({
					app: UserAdmin,
					initialData: testData
				});

				UserAdmin.on('user:selected', function(selectedUser) {
					user.controller.showUserDetails(selectedUser);
					breadCrumbs.setCrumbs([crumbs.home, crumbs.list, {title: selectedUser.get('email') }
					]);
				});

				UserAdmin.on('userList:selected', function() {
					user.controller.showUserList();
					breadCrumbs.setCrumbs([crumbs.home, crumbs.list]);
				});

				UserAdmin.on('index:selected', function() {
					UserAdmin.HomeController.showIndex();
					breadCrumbs.setCrumbs(crumbs.home);
				});
			});

			UserAdmin.addInitializer(function() {
				// init
				UserAdmin.HomeRouter = new HomeRouter();
				UserAdmin.HomeController = new HomeController();
			
				// start
				Backbone.history.start();
			});

			UserAdmin.start();

			// for debugging
			window.UserAdmin = UserAdmin;
		});
	</script>
</body>
</html>
